# coding=utf-8

import asyncio
import re
from pyrogram.enums import ChatAction, MessageEntityType
import openai
from pyrogram import Client, filters

import configparser

from pyrogram.types import MessageEntity

# –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ ConfigParser
config = configparser.ConfigParser()

# –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ config.ini
config.read('config.ini')

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ —Å–µ–∫—Ü–∏–∏ 'Config'
openai_api_key = config.get('Config', 'openai_api_key')
api_id = config.get('Config', 'api_id')
api_hash = config.get('Config', 'api_hash')

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Pyrogram Client
app = Client(name="garmvs", api_id=api_id, api_hash=api_hash)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenAI
openai.api_key = openai_api_key

# –°–ª–æ–≤–∞—Ä—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —á–∞—Ç-—Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
chat_sessions = {}
# –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–º –±–æ—Ç —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Å–æ–æ–±—â–µ–Ω–∏—è
initiated_users = set()


async def send_initial_message(user_id):
    await app.send_message(user_id,
        text='''–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–µ–Ω—è –∑–æ–≤—É—Ç –ù–∏–∫–∏—Ç–∞, –º–µ–Ω–µ–¥–∂–µ—Ä —Ñ—É–ª—Ñ–∏–ª–º–µ–Ω—Ç–∞ 2HANDS üôå\n\n–•–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å 10% —Å–∫–∏–¥–∫—É –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ –∏ —Å–ø–µ—Ü —É—Å–ª–æ–≤–∏—è –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤—É ? \n–Ø –≤–∞–º —Å–¥–µ–ª–∞—é –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç, —Å–∫–∞–∂–∏—Ç–µ –∫–∞–∫–æ–π —É –≤–∞—Å —Ç–æ–≤–∞—Ä?''',
        entities=[MessageEntity(type=MessageEntityType.TEXT_LINK, offset=54, length=6, url='https://t.me/ff_2hands')],
    )

    initiated_users.add(user_id)


def create_prompt(user_id):
    messages = chat_sessions[user_id]['messages']
    prompt = [
        {"role": "system",
         "content": """–Ø –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ –§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç 2Hands.–ú–æ—è –≥–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –æ—Ç–≤–µ—á–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ –≤—Å—è—á–µ—Å–∫–∏ –∏–º –ø–æ–º–æ–≥–∞—Ç—å.
–ü–µ—Ä–µ—á–µ–Ω—å —É—Å–ª—É–≥ —Ñ—Ñ 	–¶–µ–Ω–∞ —Ä—É–±.
—Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ –µ–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞	2
–ø–µ—Ä–µ—Å—á–µ—Ç	2
–æ—Ç–±—Ä–∞–∫–æ–≤–∫–∞ –≤–Ω–µ—à–Ω—è—è (–≤–∏–¥–Ω–æ –Ω–µ –≤–æ–æ—Ä—É–∂–µ–Ω–Ω—ã–º –≤–∑–ª—è–¥–æ–º)	5
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–Ω–æ—Å—Ç–∏ (–æ–±—É–≤—å, —Ç–æ–≤–∞—Ä—ã —Å 2 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –∏ –±–æ–ª—å—à–µ)	2
–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–º–µ—Ä–æ–≤ ( –î+–®+–í+–≤–µ—Å )	50
—Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ–π —Å–µ—Ç–∫–∏ (–¥–æ 5 –∑–∞–º–µ—Ä–æ–≤) –∑–∞ –µ–¥–∏–Ω–∏—Ü—É	200
–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ–±–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞	10
–æ–±—Ä–µ–∑–∞–Ω–∏–µ –Ω–∏—Ç–æ–∫ + –≤–Ω–µ—à–Ω—è—è –æ—Ç–±—Ä–∞–∫–æ–≤–∫–∞	15
–ø—Ä–æ—Ä–µ–∑–∏ –ø–µ—Ç–µ–ª—å –ø–æ–¥ –ø—É–≥–æ–≤—Ü—ã	2
–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–º–∫–æ–≤, –∫–ª–µ–ø–æ–∫, –∫—É–ª–∏—Å–æ–∫, –∫–∞—Ä–º–∞–Ω–æ–≤	10
–æ—á–∏—Å—Ç–∏—Ç—å –≥—Ä—è–∑—å (—Ö–∏–º—á–∏—Å—Ç–∫–∞) –æ—Ç 	500
–∫–æ–º–ª–µ–∫—Ç–æ–≤–∫–∞	2
–≤–ª–æ–∂–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–∫–∞-—Ñ–ª–∞–µ—Ä/–ø–æ–¥–∞—Ä–æ–∫ (–∫–ª–∏–µ–Ω—Ç–∞)	3
—É–ø–∞–∫–æ–≤–∫–∞ 1 –µ–¥ (–ø–∞–∫–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞, —Ç–∞—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞)	5
—É–ø–∞–∫–æ–≤–∫–∞ –≤ –ø—É–∑—ã—Ä—á–∞—Ç—É—é –ø–ª–µ–Ω–∫—É (1 —Å–ª–æ–π —Å—É–º–º–∞ —Å—Ç–æ—Ä–æ–Ω –î+–®+–í - –¥–æ 30 —Å–º)	10
—É–ø–∞–∫–æ–≤–∫–∞ –≤ –ø—É–∑—ã—Ä—á–∞—Ç—É—é –ø–ª–µ–Ω–∫—É (1 —Å–ª–æ–π —Å—É–º–º–∞ —Å—Ç–æ—Ä–æ–Ω –î+–®+–í - 30-60 —Å–º)	30
—É–ø–∞–∫–æ–≤–∫–∞ –≤ –ø—É–∑—ã—Ä—á–∞—Ç—É—é –ø–ª–µ–Ω–∫—É (1 —Å–ª–æ–π —Å—É–º–º–∞ —Å—Ç–æ—Ä–æ–Ω –î+–®+–í - 60-90 —Å–º)	50
—É–ø–∞–∫–æ–≤–∫–∞ –≤ —Å—Ç—Ä–µ–π—á –ø–ª–µ–Ω–∫—É (—Å—É–º–º–∞ —Å—Ç–æ—Ä–æ–Ω –î+–®+–í - –¥–æ 30 —Å–º)	10
—É–ø–∞–∫–æ–≤–∫–∞ –≤ —Å—Ç—Ä–µ–π—á –ø–ª–µ–Ω–∫—É (—Å—É–º–º–∞ —Å—Ç–æ—Ä–æ–Ω –î+–®+–í - 30-60 —Å–º)	30
—É–ø–∞–∫–æ–≤–∫–∞ –≤ —Å—Ç—Ä–µ–π—á –ø–ª–µ–Ω–∫—É (—Å—É–º–º–∞ —Å—Ç–æ—Ä–æ–Ω –î+–®+–í - 60-90 —Å–º)	40
—É–ø–∞–∫–æ–≤–∫–∞ –≤ —Å—Ç—Ä–µ–π—á –ø–ª–µ–Ω–∫—É (—Å—É–º–º–∞ —Å—Ç–æ—Ä–æ–Ω –î+–®+–í - 90-120 —Å–º)	50
—É–ø–∞–∫–æ–≤–∫–∞ –≤ —Å—Ç—Ä–µ–π—á –ø–ª–µ–Ω–∫—É (—Å—É–º–º–∞ —Å—Ç–æ—Ä–æ–Ω –î+–®+–í - 120-150 —Å–º)	60
–∑–∞–ø–∞–π–∫–∞ –≤ —Ä—É–∫–∞–≤ –® –¥–æ 25 —Å–º –î –¥–æ 30 —Å–º (–∫–∞–∂–¥—ã–µ 10 —Å–º+5—Ä)	15
–∑–∞–ø–∞–π–∫–∞ –≤ —Ä—É–∫–∞–≤ –®  35 —Å–º –î –¥–æ 30 —Å–º (–∫–∞–∂–¥—ã–µ 10 —Å–º+5—Ä)	25
—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞	2
—Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –í–ë (–Ω–∞ –æ–¥–∏–Ω —Ä–∞–∑–º–µ—Ä)	50
–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–∞ WB (–¥–≤–æ–π–Ω–∞—è)	6
–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–∞ OZON	8
–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –ß–ó	8
–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—Ä–æ–±/–ø–∞–ª–µ—Ç	6
—Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç –ø–æ –ø—Ä–æ—Å—å–±–µ –∫–ª–∏–µ–Ω—Ç–∞ (3 —Ñ–æ—Ç–æ)	10
–≤–∏–¥–µ–æ–æ—Ç—á–µ—Ç  –ø–æ –ø—Ä–æ—Å—å–±–µ –∫–ª–∏–µ–Ω—Ç–∞ (–æ–±–∑–æ—Ä –¥–æ 1 –º–∏–Ω)	100
—Å–±–æ—Ä–∫–∞ –∫–æ—Ä–æ–±–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ + —Å–∫–æ—á–µ–≤–∞–Ω–∏–µ	15
—Å–∫–æ—á–µ–≤–∞–Ω–∏–µ, —Å–±–æ—Ä  (—É–ø–∞–∫–æ–≤–∫–∏, –∫–æ—Ä–æ–±–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞)	5
—Å–Ω—è—Ç–∏–µ –±–∏—Ä–∫–∏ (–æ—Ç—Ä–µ–∑–∞—Ç—å)	2
–±–∏—Ä–∫–æ–≤–∞–Ω–∏–µ –Ω–∞ –±–∏—Ä–∫–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å (–±–∏—Ä–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞)	10
–±–∏—Ä–∫–æ–≤–∞–Ω–∏–µ (–±–∏—Ä–∫–∞ –ø—É—Å—Ç—ã—à–∫–∞ –§–§)	8
–∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –±–∏—Ä–∫–∏ –ø–æ –º–∞–∫–µ—Ç—É –æ—Ç 10 —Ä	8
–∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–∫–∞-—Ñ–ª–∞–µ—Ä –ø–æ –º–∞–∫–µ—Ç—É –æ—Ç 10 —Ä	10
–Ω–∞–∫–ª–µ–∏–≤–∞–Ω–∏–µ –Ω–∞–∫–ª–µ–π–∫–∏	6
–æ—Ç–ø–∞—Ä–∏–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ 1 –µ–¥	100
—Å–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –æ–±—Ä–∞–∑—Ü—É 1 –µ–¥ (—Ä—É–±–∞—à–∫–∏, –ø–∏–¥–∂–∞–∫–∏ –∏ —Ç.–¥)	50
—Ä–∞–∑–≥—Ä—É–∑–∫–∞ 1 –º–µ—Å—Ç–æ (—Ç–æ–≤–∞—Ä/–∫–æ—Ä–æ–± –¥–æ 20 –∫–≥)	100
—Ä–∞–∑–≥—Ä—É–∑–∫–∞ 1 –º–µ—Å—Ç–æ (—Ç–æ–≤–∞—Ä/–∫–æ—Ä–æ–± —Å–≤—ã—à–µ 20 –∫–≥)	150
—Ä–∞–∑–≥—Ä—É–∑–∫–∞ 1 –º–µ—Å—Ç–æ (–º–µ—à–æ–∫ –¥–æ 30–∫–≥)	300
—Ä–∞–∑–≥—Ä—É–∑–∫–∞ 1 –º–µ—Å—Ç–æ (–º–µ—à–æ–∫ —Å–≤—ã—à–µ 30–∫–≥)	400
—Ä–∞–∑–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–æ–± –≤ –æ–±—Ä–µ—à–µ—Ç–∫–µ	450
–ø–æ–≥—Ä—É–∑–∫–∞ –ø–∞–ª–ª–µ—Ç	600
–ø–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + —Å–±–æ—Ä –ø–∞–ª–ª–µ—Ç–∞	750
–≤—Å–∫—Ä—ã—Ç–∏–µ –æ–±—Ä–µ—à–µ—Ç–∫–∏ –∫–æ—Ä–æ–±	550
–≤—Å–∫—Ä—ã—Ç–∏–µ –æ–±—Ä–µ—à–µ—Ç–∫–∏ –ø–∞–ª–ª–µ—Ç	650
–∑–∞–±–æ—Ä —Å –¢–Ø–ö, –°–ê–î–û–í–û–î, –Æ–ñ –í–û–†–û–¢–ê, –ö–û–¢–ï–õ–¨–ù–ò–ö–ò –¥–æ 1–º3	2500
–∑–∞–±–æ—Ä –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î –¥–æ 1–º3	3000
–∑–∞–±–æ—Ä –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î —Å–≤—ã—à–µ 1–º3 –¥–æ 4–º3	3500
–∑–∞–±–æ—Ä –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î —Å–≤—ã—à–µ 4–º3 –¥–æ 6–º4	5500
–∑–∞–±–æ—Ä –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î —Å–≤—ã—à–µ 6–º3 –¥–æ 10–º5	10000
–∑–∞–±–æ—Ä –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –ú–ö–ê–î –¥–æ 1–º3 (–ò–ù–î–ò–í–ò–î–£–ê–õ–¨–ù–û)	3000
–æ–∂–∏–¥–∞–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è –¥–æ 15 –º–∏–Ω	0
–æ–∂–∏–¥–∞–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è –∫–∞–∂–¥—ã–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ 30 –º–∏–Ω	500
—Ö—Ä–∞–Ω–µ–Ω–∏–µ 1 –ø–æ–ª–∫–∞ 7 –¥–Ω–µ–π	250
—Ö—Ä–∞–Ω–µ–Ω–∏–µ 1 –ø–æ–ª–∫–∞ - 30 –¥–Ω–µ–π	700
—Ö—Ä–∞–Ω–µ–Ω–∏–µ 5 –ø–æ–ª–æ–∫ (—Å—Ç–µ–ª–ª–∞–∂) - 30 –¥–Ω–µ–π	2500
—Ö—Ä–∞–Ω–∏–µ–Ω–∏–µ 1 –º3 - 30 –¥–Ω–µ–π (10 –∫–æ—Ä–æ–±–æ–≤ - 60*40*40)	1800
—Ö—Ä–∞–Ω–µ–Ω–∏–µ 1 –ø–∞–ª–µ—Ç (16 –∫–æ—Ä–æ–±–æ–≤ - 60*40*40)	2500
–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –≤ –õ–ö –≤ –¢–ö –î–µ. –õ–∏–Ω., –ö–∏—Ç, –ü–µ–∫	300
–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –≤ –õ–ö –í–ë, –û–ó–û–ù	250
–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –≤ –õ–ö —Å–≤—ã—à–µ 10 –∞—Ä—Ç–∏–∫—É–ª–æ–≤ –¥–æ 20	500
–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –≤ –õ–ö —Å–≤—ã—à–µ 20 –∞—Ä—Ç–∏–∫—É–ª–æ–≤	750
—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–æ–±–∞ –ø–æ—Å—Ç–∞–≤–∫–∏ –ú–û–ù–û –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –º–ø	50
—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–æ–±–∞ –ø–æ—Å—Ç–∞–≤–∫–∏ –ú–ò–ö–° –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –º–ø	80
–¥–æ—Å—Ç–∞–≤–∫–∞ –ö–æ–ª–µ–¥–∏–Ω–æ FBO WB —Ü–µ–Ω–∞ –∑–∞ 1 –∫–æ—Ä–æ–±	300
–¥–æ—Å—Ç–∞–≤–∫–∞ –ö–æ–ª–µ–¥–∏–Ω–æ FBO WB 1 –ø–∞–ª–ª–µ—Ç	3000
–¥–æ—Å—Ç–∞–≤–∫–∞ –ü–æ–¥–æ–ª—å—Å–∫ FBO WB —Ü–µ–Ω–∞ –∑–∞ 1 –∫–æ—Ä–æ–±	300
–¥–æ—Å—Ç–∞–≤–∫–∞ –ü–æ–¥–æ–ª—å—Å–∫ FBO WB 1 –ø–∞–ª–ª–µ—Ç	3000
–¥–æ—Å—Ç–∞–≤–∫–∞ –¢—É–ª–∞ FBO WB —Ü–µ–Ω–∞ –∑–∞ 1 –∫–æ—Ä–æ–±–∫—É	450
–¥–æ—Å—Ç–∞–≤–∫–∞ –¢—É–ª–∞ FBO WB –æ—Ç 1 –ø–∞–ª–µ—Ç–∞	4500
–¥–æ—Å—Ç–∞–≤–∫–∞ –ë.–°—Ç–æ–ª–±—ã FBO WB –æ—Ç 1 –ø–∞–ª–ª–µ—Ç–∞	3500
–¥–æ—Å—Ç–∞–≤–∫–∞ –ö–∞–∑–∞–Ω—å FBO WB —Ü–µ–Ω–∞ –∑–∞ 1 –∫–æ—Ä–æ–±–∫—É	500
–¥–æ—Å—Ç–∞–≤–∫–∞ –ö–∞–∑–∞–Ω—å FBO WB 1 –ø–∞–ª–ª–µ—Ç–∞	5000
–¥–æ—Å—Ç–∞–≤–∫–∞ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä FBO WB —Ü–µ–Ω–∞ –∑–∞ 1 –∫–æ—Ä–æ–±–∫—É	650
–¥–æ—Å—Ç–∞–≤–∫–∞ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä FBO WB 1 –ø–∞–ª–ª–µ—Ç–∞	6500
–¥–æ—Å—Ç–∞–≤–∫–∞ –®—É—à–∞—Ä—ã FBO WB —Ü–µ–Ω–∞ –∑–∞ 1 –∫–æ—Ä–æ–±–∫—É	500
–¥–æ—Å—Ç–∞–≤–∫–∞ –®—É—à–∞—Ä—ã FBO WB 1 –ø–∞–ª–ª–µ—Ç–∞	5000
–¥–æ—Å—Ç–∞–≤–∫–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ FBO —Ä–∞—Å—Ü–µ–Ω–∫–∏ –¢–ö	0
–¥–æ—Å—Ç–∞–≤–∫–∞ FBO WB –≠–õ–ï–ö–¢–†–û–°–¢–ê–õ–¨ –∑–∞ 1 –∫–æ—Ä–æ–±	450
–¥–æ—Å—Ç–∞–≤–∫–∞ FBO WB –≠–õ–ï–ö–¢–†–û–°–¢–ê–õ–¨ 1 –ø–∞–ª–ª–µ—Ç–∞	4000
–¥–æ—Å—Ç–∞–≤–∫–∞ FBO –û–ó–û–ù —Ü–µ–Ω–∞ –∑–∞ 1 –∫–æ—Ä–æ–±	450
–¥–æ—Å—Ç–∞–≤–∫–∞ FBO –û–ó–û–ù –•–æ—Ä—É–≥–≤–∏–Ω–æ, –ü—É—à–∫–∏–Ω–æ - 1 –ø–∞–ª–ª–µ—Ç	4500
–ó–∞–±–æ—Ä —Å–∞–º–æ–≤—ã–∫—É–ø–æ–≤ —Ü–µ–Ω–∞ –∑–∞ –µ–¥–µ–Ω–∏—Ü—É	200
–û—Ç–∑—ã–≤ –±–µ–∑ —Ñ–æ—Ç–æ	100
–§–û–¢–û–æ—Ç–∑—ã–≤	200
–§–æ—Ç–æ—Å—ä–µ–º–∫–∞ 1 —Ä—Ç–∏–∫—É–ª (5 —Ñ–æ—Ç–æ) —Ü–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∑	2200
–§–æ—Ç–æ—Å—ä–µ–º–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–Ω–∞—è —Ü–∏–∫–ª–æ—Ä–∞–º–∞ 1 –∫–∞–¥—Ä	350
–∫–æ—Ä–æ–± 60—Ö40—Ö40	100
–ø–∞–ª–ª–µ—Ç –±/—É	350
—Ä–µ–∑–∏–Ω–∫–∞ –¥–≤–æ–π–Ω–∞—è –¥–ª—è –æ–±—É–≤–Ω–æ–π –∫–æ—Ä–æ–±–∫–∏	2
–±–∏—Ä–∫–∞ –ø—É—Å—Ç—ã—à–∫–∞ 	1
–ø–∞–ª–ª–µ—Ç –µ–≤—Ä–æ –Ω–æ–≤—ã–π	600
–ø–∞–∫–µ—Ç –∑–∏–ø–ª–æ–∫ 25*35	13
–ø–∞–∫–µ—Ç –∑–∏–ø–ª–æ–∫ 30*40	14
–ø–∞–∫–µ—Ç –∑–∏–ø–ª–æ–∫ 35*45	15
–ø–∞–∫–µ—Ç –∑–∏–ø–ª–æ–∫ 40*60	17
–ø–∞–∫–µ—Ç –∑–∏–ø–ª–æ–∫ 50*70	21
–ø–∞–∫–µ—Ç –ë–û–ü–ü –æ—Ç 5—Ä	5
–ø–∞–∫–µ—Ç –∫—É—Ä—å–µ—Ä—Å–∫–∏–π (–Ω–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –¥–ª—è –æ–∑–æ–Ω) –æ—Ç 5—Ä	5
–í—ä–µ–∑–¥ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –§–§ –ª–µ–≥–∫–æ–≤–æ–π –º–∞—à–∏–Ω—ã	200
–í—ä–µ–∑–¥ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –§–§ –≥—Ä—É–∑–æ–≤–æ–π –º–∞—à–∏–Ω—ã	300
–í—ä–µ–∑–¥ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é —Ä—ã–Ω–∫–∞ –¢–Ø–ö –≥—Ä—É–∑–æ–≤–æ–π –º–∞—à–∏–Ω—ã	700
–í—ä–µ–∑–¥ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é —Ä—ã–Ω–∫–∞ –Æ–∂–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞  –≥—Ä—É–∑–æ–≤–æ–π –º–∞—à–∏–Ω—ã –¥–æ 6–º3	1500
–í—ä–µ–∑–¥ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é —Ä—ã–Ω–∫–∞ –Æ–∂–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞  –≥—Ä—É–∑–æ–≤–æ–π –º–∞—à–∏–Ω—ã —Å–≤—ã—à–µ 6–º3	2000
–£—Å–ª—É–≥ –≥—Ä—É–∑—á–∏–∫–∞ –Ω–∞ —Ä—ã–Ω–∫–µ –∑–∞ 1 –º–µ—à–æ–∫ 	300
–£—Å–ª—É–≥ –≥—Ä—É–∑—á–∏–∫–∞ –Ω–∞ —Ä—ã–Ω–∫–µ –∑–∞ 1 –ø–∞–ª–ª–µ—Ç (–ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é)	1500
–î–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞ —Å–∫–ª–∞–¥—ã –¢–ö (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ)	0
–î–æ—Å—Ç–∞–≤–∫–∞ –≤ –°–î–≠–ö	500		
"""}

    ]
    prompt.extend(messages)
    return prompt


async def handle_chat_with_gpt(user_id, message):
    if user_id not in chat_sessions:
        chat_sessions[user_id] = {'messages': []}

    chat_sessions[user_id]['messages'].append({'role': 'user', 'content': message})

    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ Enum –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ "–ø–µ—á–∞—Ç–∞–µ—Ç"
    await app.send_chat_action(user_id, ChatAction.TYPING)

    prompt = create_prompt(user_id)
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo-1106",
        messages=prompt
    )

    chat_sessions[user_id]['messages'].append(
        {'role': 'assistant', 'content': response['choices'][0]['message']['content']})
    await app.send_message(user_id, response['choices'][0]['message']['content'])


# –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
keywords_pattern = re.compile(r'\b(—Ñ—É–ª—Ñ–∏–ª–º–µ–Ω—Ç|–ø—Ä–∞–π—Å|—Ä–∞—Å—Ü–µ–Ω–∫–∏|–¥–æ—Å—Ç–∞–≤–∫–∞|—É—Å–ª—É–≥–∏|–¥–æ–≥–æ–≤–æ—Ä|—Ç–æ–≤–∞—Ä—ã)\b',
                              re.IGNORECASE)


@app.on_message(filters.text & filters.regex(keywords_pattern) & ~filters.private)
async def detect_keywords_in_group(client, message):
    user_id = message.from_user.id
    if user_id not in initiated_users:
        await send_initial_message(user_id)


@app.on_message(filters.command("stopchat"))
async def stop_chat(client, message):
    user_id = message.from_user.id
    if user_id in initiated_users:
        initiated_users.remove(user_id)
        await message.reply_text("–û–±—â–µ–Ω–∏–µ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–æ.")


@app.on_message(filters.command("startchat"))
async def start_chat(client, message):
    user_id = message.from_user.id
    if user_id not in initiated_users:
        initiated_users.add(user_id)
        await message.reply_text("–û–±—â–µ–Ω–∏–µ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–æ.")


@app.on_message(filters.private & ~filters.command("start"))
async def private_message_handler(client, message):
    user_id = message.from_user.id
    if user_id in initiated_users:
        await handle_chat_with_gpt(user_id, message.text)


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
app.run()
